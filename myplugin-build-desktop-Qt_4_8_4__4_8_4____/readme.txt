README by lwx19911226
目录
>0. 本期推荐
>1. 快速上手
>1.1 简介
>1.2 主要流程
>1.2.0 主界面
>1.2.1 选择设计文件
>1.2.2 新建武将与触发技
>1.2.3 删除武将和触发技
>1.2.4 导入已有设计文件
>1.2.5 导出
>1.2.6 补充说明
>1.3 设计文件快速入手
>1.3.0 总体格式
>1.3.1 扩展包信息
>1.3.2 武将信息
>1.3.3 技能信息
>1.3.4 技能行为信息
>1.3.5 补充说明
>1.4 技能设计流程
>1.4.0 相关概念
>1.4.1 主界面
>1.4.2 【集智】示例
>1.4.3 PATTERN
>1.4.4 补充说明
>2. 详细说明
>2.1 PACKAGE
>2.2 GENERAL
>2.3 EVENT
>2.4 技能拥有者与时机触发者
>2.5 触发技类型
>2.6 FUNCTION
>2.6.1 人机交互
>2.7 OBJECT
>2.7.1 PLAYER
>2.7.2 CARD
>2.7.3 NUMBER
>2.7.4 STRING
>2.7.5 BOOL
>2.7.6 LIST
>2.7.7 STRUCT
>2.8 代码结构
>2.8.1 顺序结构
>2.8.2 条件结构
>2.8.3 循环结构
>2.8.4 BLOCK
>2.8.5 多时机触发
>2.9 REMARK
>3. FAQ
>3.1 为什么是ALPHA版
>3.2 和武将工厂的关系
>3.3 汉化
>4. 更新日志
===
>0. 本期推荐
保存和载入，设计中断也没关系
本来不准备自动保存的，但是出现过几次不重现的崩溃..所以加入自动保存功能（仅在行为操作后），如果崩溃了请重新启动程序并提示载入
丰富技能类型，覆盖大多数设计
流程树图，应该比代码更近人吧..
已有技能列表，方便查询和添加已有技能
汉化，一定程度上友好化
>1. 快速上手
>1.1 简介
本程序希望引导用户通过人机交互生成太阳神三国杀LUA扩展文件。目前API支持0224版。
>1.2 主要流程
>1.2.0 主界面
顶部有扩展包名称和翻译的输入框，回车确认
上半部分展示武将和技能的相关信息（名称翻译类型描述等），可即时修改
按钮“新建”和“删除”可对武将和技能列表修改，请及时命名
按钮“添加技能行为”，需选择技能
按钮“撤销”|“恢复”仅针对技能行为的增删
按钮“导入”可导入设计文件
按钮“导出”可导出LUA文件和设计文件，请先对扩展包命名
下半部分是生成的LUA文件预览，翻译表部分我加了几个自己写的函数
可选择当前技能部分预览
可选择当前技能流程树状图示
>1.2.1 选择设计文件
设计文件包含扩展包武将技能及翻译
编码为ANSI
不选择设计文件时，将从零开始，请注意扩展包命名
>1.2.2 新建武将与触发技
分别于武将和技能tab页使用按钮“新建”，双击单元格可修改
>1.2.3 删除武将和触发技
先选中单元格，按钮“删除”，删除选中单元格对应的武将或技能
>1.2.4 导入已有设计文件
按钮“导入”
>1.2.5 导出
按钮“导出”，设计文件同时还包含已完成的技能行为，导入时会自动添加
>1.2.6 补充说明
目前不支持删除武将和技能的撤销..
输入框记得回车
先输名字，名字很重要，别重名
话说这个程序应该取个什么名字..
>1.3 设计文件快速入手
>1.3.0 总体格式
正文每行均以若干>为起始，各部分以|分隔
>1.3.1 扩展包信息
以>起始，示例 >shzl|神话再临 ，表示扩展包名称为shzl，翻译为神话再临
>1.3.2 武将信息
以>>起始，示例 >>luasmy|司马|wei|m|3|#狼顾之鬼|~天命难违|cv:who ，表示武将名luasmy，翻译司马，魏，男，3血，以及称号台词和CV
>1.3.3 技能信息
以>>>起始，示例 >>>trs|luaguicai|鬼才|luasmy|NotFrequent|:你可以用手牌改判定|$天命哈哈哈|$天命哈哈哈哈哈 ，表示触发技，技能名luaguicai，翻译鬼才，非常时技能，拥有者luasmy，以及描述和台词
>1.3.4 技能行为信息
以>>>>起始，由程序生成记录技能行为，用户可以无视
>1.3.5 补充说明
之所以想加入设计文件这货，是因为我自己DIY技能时经常改来改去，文案很繁
想设计一种可以当文案，程度也能直接读取的文件，虽然现在已经偏离初衷，仅作为程序用配置文件..
>1.4 技能设计流程
>1.4.0 相关概念
>1.4.0.1 技能分类
目前支持的技能类型为触发技|视为技|距离技|锁定视为技|禁止技|手牌上限技|目标技|已有技能
简单理解：
视为技，需要出牌阶段用手点技能（【仁德】）
触发技，会在特定时机由系统与用户交互，可联系OL国战的点亮
距离技，像【马术】【义从】这种
锁定视为技，像【天香】这种，各种FAQ出没
禁止技，无法成为目标，【空城】【帷幕】等
手牌上限技，额外手牌上限，像【血裔】
目标技，目前为三部分，额外目标，额外距离，额外次数，比如【天义】
已有技能，表示你想添加一个已有的技能，比如【马术】党
>1.4.0.2 时机
触发技基本组成：触发时机（when）|相关对象（who,what）|相关行为（what to do）
比如【突袭】，触发时机（技能拥有者摸牌阶段开始）|相关对象（技能拥有者所选1至2名其它角色手中各1张牌）|相关行为（技能拥有者跳过摸牌阶段，获得牌）
不同时机的固有对象，如使用牌时CardUsed（使用者|目标|使用的牌），受到伤害时Damaged（受伤者|伤害来源|..）
将其推广至其它技能类型（嘛，主要是想复用下结构）
>1.4.0.3 程序化流程
程序化流程为，准备好所需对象，令其执行相关行为
关于流程补充说明，流程包括：顺序（..然后..）|条件（如果..就..否则..,if..then..else..）|循环（对每一个对象都做..）
如上..部分可理解为代码段Block，每种触发时机都有其默认代码段，特殊结构还会产生小代码段（比如条件结构），可对代码段编号命名，需将行为加入合适的代码段
技能行为，表示相关对象在对应时机和代码段执行行为并返回结果，核心为行为（比如选择一名角色askForPlayerChosen|判断非延时锦囊isNDTrick）
顺序结构，先..再..，本程序同一代码段中，先加入的行为先执行
条件结构，比如【悲歌】（如果 判定牌花色==红桃 就 .. 否则如果 判定牌花色==方块 就 ..）；再如【集智】（如果 所用的牌是否为非延时锦囊==真 就 ..），此时先通过isNDTrick返回布尔值（真或假）
循环结构，对给定列表中的每个对象依次进行相同操作，比如【归心】（给定列表为其余角色，操作为获得其一张牌）
>1.4.1 主界面
按钮“添加行为”，弹出窗口，在多列视图中依次选择完成，点击添加完成
“输入其它值”仅支持所需数字常数和字符串常量，双击并输入数字即可添加所需常数
筛选输入框可对末列选项及其标注进行筛选（支持正则），支持中文
筛选选择框可以通过标签进行过滤
标注展示框依次展示所选对象的标注
标注输入框则可对本次操作产生的新对象或新代码段进行标注，方便查询
仅标注和筛选支持中文
>1.4.2 触发技【集智】示例
技能描述：你使用非延时锦囊牌时，可立即摸一张牌
所需行为：是否技能拥有者|是否非延时锦囊isNDTrick|询问角色是否发动|摸牌drawCards
所需时机：使用牌时CardUsed
先判断是否技能拥有者（CardUsed->CardUsed->onlySkillOwner）
再判断是否非延时锦囊（CardUsed->CardUsed->isNDTrick->use.card）所用的牌use.card为固有对象，返回布尔值，可标注“所用的牌是非延时锦囊吗其实不用这么长也可以”
添加条件结构，所用为非延时为真时（CardUsed->CardUsed->ifTrue->isNDTrick_mybool_1），可标注“这是所用的牌是非延时锦囊代码段”和“这是所用的牌是不非延时锦囊代码段”
可注意到两个新代码段，可从标注区分
询问是否发动（CardUsed->CardUsed,..->ifActivation->selfplayer）
摸牌（CardUsed->CardUsed,..->drawCards->selfplayer->1），常数1需要双击input others添加
>1.4.4 补充说明
myevent.txt|myconst.txt|myfun.txt可自行添加
nil表示不存在，某些情况用得上，但请注意使用情况
>2. 详细说明
>2.1 PACKAGE
扩展包，目前支持lua武将扩展
命名为EN（字母数字下划线，见程序变量命名规则），且必须与lua文件同名
>2.2 GENERAL
武将命名同上
切换性别等于切换武将
武将与技能的关系是动态的，换句话说，无关系
武将携带的技能，表示武将在开始时由系统分配的技能，有些技能不在武将身上（【急袭】），有些技能还会掉（【断肠】），更常见的是装备技
>2.3 EVENT
触发时机，游戏系统遵循一定规律运行，我们将一些特殊的时点定义为触发时机
触发技相当于提前通知系统，在特殊时点有动作
系统在到达特殊时点时，就会完成触发技预定的动作
同一时点有多个触发技，就需要遵循一定准则依次发动，比如优先级，比如座次，比如细分时点（伤害前伤害中伤害后..）
时机列表，见源码struct.h
>2.4 技能拥有者与时机触发者
时机往往由角色触发，这种理解是自然的（使用者触发CardUsed|受伤者触发Damaged）
但时机触发者不一定为技能拥有者
以【急救】为例，时机触发者濒死，技能拥有者老头
系统设定触发条件，默认为“时机触发者为技能拥有者且存活”
本程序中（个人习惯）设定为“技能拥有者存活”，即你可以在别人的时机触发自己的技能
需要时，请先判断时机触发者是否为技能拥有者
特例，有些技能死了才触发..
补充，以上均未考虑场上复数相同技能的情况（系统找不到唯一技能拥有者）
>2.5 触发技类型
与内部实现无关，仅与技能图标有关..
NotFrequent，非常时发动
Frequent，常时发动，也可以理解为在选择“是否发动”时，总选是，比如【洛神】
Compulsory，锁定技，但也可以添加行为询问“是否发动”..
Limited，限定技
Wake，觉醒技
具体来说，默认类型为NotFrequent；如果对于askForSkillInvoke，通常选择发动，则可设为Frequent；如果没有askForSkillInvoke，可设为Compulsory；如果设为Limited和Wake，实现上要通过marker
>2.6 FUNCTION
广义上的行为，对相关对象进行操作
一般需要提供特定类型的参数对象（输入），并获得特定类型返回对象作为结果（输出），也可能产生新的代码段供接下来的行为使用
用户往往需要通过查询源码来确定所需函数的形式意义和使用方法
本程序希望能帮助不熟悉的用户
补充，函数可能有多个返回值
>2.6.1 人机交互
技能流程中人机交互也通过一些函数完成，比如询问发动askForSkillInvoke|选择一名角色askForPlayerChosen|选择牌askForCardaskForCardChose
也是AI关注的重点
>2.7 OBJECT
对象，行为主体与客体
目前对于固有对象是否存在的处理有些粗暴..
注意类名与对象名的区别
简单来说，类名（人），对象名（见身份证）
有些情况需要类名，有些情况需要对象名
lang文件夹下可以找到各种对象名..
>2.7.1 PLAYER
注意一般不能直接判断player1与player2是否相等，而是通过判断对象名或是座位的方式
>2.7.2 CARD
注意虚拟卡与子卡的概念
主要用于实现视为技和卡的转移
容易理解，【奇袭】的拆为虚拟卡，黑牌为其子卡，而【乱击】的万箭有两张子卡
【仁德】也是一张虚拟卡，子卡n
>2.7.3 NUMBER
注意每张实卡都会有唯一对应的数字ID，不过一般不用于运算..
座位也是数字编号，运算的情况（你的左手边..）
各种枚举类型也是数字编号，比如四种花色七个阶段
>2.7.4 STRING
字符串，类名和对象名，选项内容，聊天
卡牌点数比较特别，111213是数字，JQK是字符串
>2.7.5 BOOL
布尔值，表示逻辑真或假
主要用于判断（角色是否存活|是否有XX牌）
基本逻辑（与|或）
>2.7.6 LIST
同类对象的集合，比如“所有有装备的人”（变卖所有装备~）
>2.7.7 STRUCT
不同类对象的组合，比如受伤时，同时产生了受伤者，伤害来源，伤害点数等多种数据
>2.8 代码结构
>2.8.1 顺序结构
好像没什么好说的..
>2.8.2 条件结构
if .. then elseif .. then else end
上示 .. 即为BOOL
>2.8.3 循环结构
目前实现为遍历列表，即先准备好一个列表（比如所有存活角色列表），然后依次对其执行相同操作（比如speak("I love U")）
注意最好不要在循环里修改列表内容
也可以用来实现限定次数循环
还未实现非限定次数循环（一般也不需要，100==伪无穷）
>2.8.4 BLOCK
多行代码构成代码块,具有嵌套性
本程序中，每个时机都有对应默认代码块，其它代码依附之
请合理标注，以处理代码块较多的情况
>2.8.5 多时机触发
触发技可能在多个时机触发完成多阶段行为，比如【裸衣】（摸牌阶段|造成伤害时）
技能在不同时机的实现是相对独立的，即摸牌阶段有没有破在决斗时是不知道的，可通过一些方式存储和传递信息
程序目前的实现为，相关对象的作用域为对应的整个时机，亦即，你可以在不知道它是谁的时候使用它的名字，请不要这么做
>2.9 REMARK
标注，用户可以手动标注OBJECT和BLOCK，便于查询和理解，支持中文支持filter
>3. FAQ
>3.1 为什么是ALPHA版
我对这版api熟悉些..
以后也会更新到双蛇api
>3.2 和武将工厂的关系
应该实现和功能不一样吧
程序不准备贴图，也不准备帮用户贴图..
>3.3 汉化
慢慢来，Qt还要慢慢学..
>3.4 崩溃
出现过几次，原因和重现方法不明..
所以添加了自动保存功能，如果出现崩溃，请重新启动程序，会提示载入
>4. 更新日志
130501 整合多类型技能
130301 整合function
130218 添加设计文件与翻译
130220 添加foreach|pattern|import|export